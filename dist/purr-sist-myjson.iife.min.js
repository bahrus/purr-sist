!function(){const t="disabled";const e="base-link-id";const s="store-id",i="write",r="read",a="new",n="guid",h="master-list-id";class l extends(function(t){return class extends t{get baseLinkId(){return this._baseLinkId}set baseLinkId(t){this.setAttribute(e,t)}getFullURL(t){let e=t;if(this._baseLinkId){const t=self[this._baseLinkId];t&&(e=t.href+e)}return e}}}(function(e){return class extends e{constructor(){super(...arguments),this._evCount={}}static get observedAttributes(){return[t]}get disabled(){return this._disabled}set disabled(e){this.attr(t,e,"")}attr(t,e,s){this[(e?"set":"remove")+"Attribute"](t,s||e)}to$(t){const e=t%2;return(t-e)/2+"-"+e}incAttr(t){const e=this._evCount;t in e?e[t]++:e[t]=0,this.attr("data-"+t,this.to$(e[t]))}attributeChangedCallback(e,s,i){switch(e){case t:this._disabled=null!==i}}de(t,e,s=!1){const i=t+(s?"":"-changed"),r=new CustomEvent(i,{detail:e,bubbles:!0,composed:!1});return this.dispatchEvent(r),this.incAttr(i),r}_upgradeProperties(t){t.forEach(t=>{if(this.hasOwnProperty(t)){let e=this[t];delete this[t],this[t]=e}})}}}(HTMLElement))){constructor(){super(...arguments),this._initInProgress=!1}static get observedAttributes(){return super.observedAttributes.concat([s,i,r,a,n,h])}attributeChangedCallback(t,e,l){switch(super.attributeChangedCallback(t,e,l),t){case s:this._storeId=l,this.de("store-id",{value:l});break;case h:this._masterListId=l;break;case n:this._guid=l;break;case a:case i:case r:this["_"+t]=null!==l}this.onPropsChange(t)}get storeId(){return this._storeId}set storeId(t){this._storeId=t,this.attr(s,t),this.syncMasterList()}syncMasterList(){if(!this._masterListId||!this._guid)return;const t=this.getMaster();t&&t.value?void 0===t.value[this._guid]&&(t.newVal={[this._guid]:this._storeId}):setTimeout(()=>{this.syncMasterList()},50)}pullRecFromMaster(t){void 0===t.value[this._guid]?this._write&&this.createNew(t):this.storeId=t.value[this._guid]}set refresh(t){this.storeId=this._storeId}get write(){return this._write}set write(t){this.attr(i,t,"")}get read(){return this._read}set read(t){this.attr(r,t,"")}get new(){return this._new}set new(t){this.attr(a,t,"")}get guid(){return this._guid}set guid(t){this.attr(n,t)}get masterListId(){return this._masterListId}set masterListId(t){this.attr(h,t)}set historyEvent(t){t.url!==this._storeId&&(t.url=this._storeId);const e=t.value;e&&(e.__purrSistInit?(delete e.__purrSistInit,this.value=e):this.newVal=t.value)}get newVal(){return this._newVal}set newVal(t){if(null!==t){if(!this._storeId)return this._pendingNewVals||(this._pendingNewVals=[]),void this._pendingNewVals.push(t);this._newVal=t,this.saveNewVal(t)}}connectedCallback(){this._upgradeProperties(["storeId",i,r,a,t,n,"masterListId"]),this.style.display="none",this._conn=!0,this.onPropsChange()}get value(){return this._value}set value(t){this._value=t,this.de("value",{value:t})}getMaster(){if(!this._masterListId.startsWith("/"))throw'Must start with "/"';return self[this._masterListId.substr(1)]}onPropsChange(t){if(this._conn&&!this._disabled)if(this._storeId){if(this._write)return;this.getStore()}else if(this._masterListId){const t=this.getMaster();if(!t||!t.value)return void setTimeout(()=>{this.onPropsChange()},50);this.pullRecFromMaster(t)}else this._new&&this._write&&this.createNew(null)}}const o="save-service-url";!function(t){let e=t.is;customElements.get(e)?console.warn("Already registered "+e):customElements.define(e,t)}(class extends l{static get is(){return"purr-sist-myjson"}static get observedAttributes(){return super.observedAttributes.concat([o])}attributeChangedCallback(t,e,s){switch(t){case o:this._saveServiceUrl=s}super.attributeChangedCallback(t,e,s)}createNew(t){if(this._initInProgress)return;const e={};fetch(this._saveServiceUrl,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)}).then(e=>{e.json().then(e=>{this._initInProgress=!1,this.storeId=e.uri.split("/").pop(),this._pendingNewVals&&(this._pendingNewVals.forEach(t=>{this.newVal=t}),delete this._pendingNewVals),null!==t&&(t.newVal={[this._guid]:this._storeId})})}),this.value=e}get saveServiceUrl(){return this._saveServiceUrl}set saveServiceUrl(t){this.attr(o,t)}saveNewVal(t){fetch(this._saveServiceUrl+"/"+this._storeId,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)}).then(e=>{this.value=t})}connectedCallback(){this._upgradeProperties(["saveServiceUrl"]),this._saveServiceUrl||(this._baseLinkId?this._saveServiceUrl=this.getFullURL(""):this._saveServiceUrl="https://api.myjson.com/bins"),super.connectedCallback()}onPropsChange(t){this._saveServiceUrl&&super.onPropsChange()}getStore(){this._fip||(this._fip=!0,fetch(this._saveServiceUrl+"/"+this._storeId).then(t=>{t.json().then(t=>{t.__purrSistInit=!0,this.value=t,this._fip=!1})}))}})}();