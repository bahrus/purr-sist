(function(){var disabled="disabled";function XtallatX(superClass){return function(_superClass){babelHelpers.inherits(_class,_superClass);function _class(){var _this;babelHelpers.classCallCheck(this,_class);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(_class).apply(this,arguments));_this._evCount={};return _this}babelHelpers.createClass(_class,[{key:"attr",value:function attr(name,val,trueVal){var v=val?"set":"remove";this[v+"Attribute"](name,trueVal||val)}},{key:"to$",value:function to$(n){var mod=n%2;return(n-mod)/2+"-"+mod}},{key:"incAttr",value:function incAttr(name){var ec=this._evCount;if(name in ec){ec[name]++}else{ec[name]=0}this.attr("data-"+name,this.to$(ec[name]))}},{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldVal,newVal){switch(name){case disabled:this._disabled=null!==newVal;break;}}},{key:"de",value:function de(name,detail){var asIs=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1,eventName=name+(asIs?"":"-changed"),newEvent=new CustomEvent(eventName,{detail:detail,bubbles:!0,composed:!1});this.dispatchEvent(newEvent);this.incAttr(eventName);return newEvent}},{key:"_upgradeProperties",value:function _upgradeProperties(props){var _this2=this;props.forEach(function(prop){if(_this2.hasOwnProperty(prop)){var value=_this2[prop];delete _this2[prop];_this2[prop]=value}})}},{key:"disabled",get:function get(){return this._disabled},set:function set(val){this.attr(disabled,val,"")}}],[{key:"observedAttributes",get:function get(){return[disabled]}}]);return _class}(superClass)}function define(custEl){var tagName=custEl.is;if(customElements.get(tagName)){console.warn("Already registered "+tagName);return}customElements.define(tagName,custEl)}var baseLinkId="base-link-id";function BaseLinkId(superClass){return function(_superClass2){babelHelpers.inherits(_class2,_superClass2);function _class2(){babelHelpers.classCallCheck(this,_class2);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(_class2).apply(this,arguments))}babelHelpers.createClass(_class2,[{key:"getFullURL",value:function getFullURL(tail){var r=tail;if(this._baseLinkId){var link=self[this._baseLinkId];if(link)r=link.href+r}return r}},{key:"baseLinkId",get:function get(){return this._baseLinkId},set:function set(val){this.setAttribute(baseLinkId,val)}}]);return _class2}(superClass)}var store_id="store-id",write="write",read="read",new$="new",guid="guid",master_list_id="master-list-id",PurrSist=function(_BaseLinkId){babelHelpers.inherits(PurrSist,_BaseLinkId);function PurrSist(){var _this3;babelHelpers.classCallCheck(this,PurrSist);_this3=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(PurrSist).apply(this,arguments));_this3._initInProgress=!1;return _this3}babelHelpers.createClass(PurrSist,[{key:"attributeChangedCallback",value:function attributeChangedCallback(n,ov,nv){babelHelpers.get(babelHelpers.getPrototypeOf(PurrSist.prototype),"attributeChangedCallback",this).call(this,n,ov,nv);switch(n){case store_id:this._storeId=nv;this.de("store-id",{value:nv});break;case master_list_id:this._masterListId=nv;break;case guid:this._guid=nv;break;case new$:case write:case read:this["_"+n]=null!==nv;break;}this.onPropsChange(n)}},{key:"syncMasterList",value:function syncMasterList(){var _this4=this;if(!this._masterListId||!this._guid)return;var master=this.getMaster();if(!master||!master.value){setTimeout(function(){_this4.syncMasterList()},50);return}if(master.value[this._guid]===void 0){master.newVal=babelHelpers.defineProperty({},this._guid,this._storeId)}}},{key:"pullRecFromMaster",value:function pullRecFromMaster(master){if(master.value[this._guid]===void 0){if(this._write){this.createNew(master)}}else{this.storeId=master.value[this._guid]}}},{key:"connectedCallback",value:function connectedCallback(){this._upgradeProperties(["storeId",write,read,new$,disabled,guid,"masterListId","historyEvent","value","syncVal"]);this.style.display="none";this._conn=!0;this.onPropsChange()}},{key:"getMaster",value:function getMaster(){if(!this._masterListId.startsWith("/"))throw"Must start with \"/\"";return self[this._masterListId.substr(1)]}},{key:"onPropsChange",value:function onPropsChange(n){var _this5=this;if(!this._conn||this._disabled)return;if(!this._storeId){if(this._masterListId){var mst=this.getMaster();if(!mst||!mst.value){setTimeout(function(){_this5.onPropsChange()},50);return}this.pullRecFromMaster(mst)}else if(this._new&&this._write){this.createNew(null)}}else{if(this._write)return;this.getStore()}}},{key:"storeId",get:function get(){return this._storeId},set:function set(val){this._storeId=val;this.attr(store_id,val);this.syncMasterList()}},{key:"refresh",set:function set(val){this.storeId=this._storeId}},{key:"write",get:function get(){return this._write},set:function set(nv){this.attr(write,nv,"")}},{key:"read",get:function get(){return this._read},set:function set(nv){this.attr(read,nv,"")}},{key:"new",get:function get(){return this._new},set:function set(nv){this.attr(new$,nv,"")}},{key:"guid",get:function get(){return this._guid},set:function set(nv){this.attr(guid,nv)}},{key:"masterListId",get:function get(){return this._masterListId},set:function set(nv){this.attr(master_list_id,nv)}},{key:"historyEvent",get:function get(){return this._historyEvent},set:function set(val){this._historyEvent=val;if(val.url!==this._storeId){val.url=this._storeId}var v=val.value;if(!v)return;console.log(v);if(v.__purrSistInit){delete v.__purrSistInit;this.value=v}else{this.newVal=val.value}}},{key:"syncVal",get:function get(){return this._syncVal},set:function set(val){this._syncVal=val;this.value=val}},{key:"newVal",get:function get(){return this._newVal},set:function set(val){if(null===val)return;if(!this._storeId){if(!this._pendingNewVals)this._pendingNewVals=[];this._pendingNewVals.push(val);return}this._newVal=val;this.saveNewVal(val)}},{key:"value",get:function get(){return this._value},set:function set(val){this._value=val;this.de("value",{value:val})}}],[{key:"observedAttributes",get:function get(){return babelHelpers.get(babelHelpers.getPrototypeOf(PurrSist),"observedAttributes",this).concat([store_id,write,read,new$,guid,master_list_id])}}]);return PurrSist}(BaseLinkId(XtallatX(HTMLElement))),save_service_url="save-service-url",PurrSistMyJson=function(_PurrSist){babelHelpers.inherits(PurrSistMyJson,_PurrSist);function PurrSistMyJson(){babelHelpers.classCallCheck(this,PurrSistMyJson);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(PurrSistMyJson).apply(this,arguments))}babelHelpers.createClass(PurrSistMyJson,[{key:"attributeChangedCallback",value:function attributeChangedCallback(n,ov,nv){switch(n){case save_service_url:this._saveServiceUrl=nv;break;}babelHelpers.get(babelHelpers.getPrototypeOf(PurrSistMyJson.prototype),"attributeChangedCallback",this).call(this,n,ov,nv)}},{key:"createNew",value:function createNew(master){var _this6=this;if(this._initInProgress)return;var val={};fetch(this._saveServiceUrl,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(val)}).then(function(resp){resp.json().then(function(json){_this6._initInProgress=!1;_this6.storeId=json.uri.split("/").pop();if(_this6._pendingNewVals){_this6._pendingNewVals.forEach(function(kvp){_this6.newVal=kvp});delete _this6._pendingNewVals}if(null!==master)master.newVal=babelHelpers.defineProperty({},_this6._guid,_this6._storeId)})});this.value=val}},{key:"saveNewVal",value:function saveNewVal(value){var _this7=this;fetch(this._saveServiceUrl+"/"+this._storeId,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",body:JSON.stringify(value)}).then(function(resp){_this7.value=value})}},{key:"connectedCallback",value:function connectedCallback(){this._upgradeProperties(["saveServiceUrl"]);if(!this._saveServiceUrl){if(this._baseLinkId){this._saveServiceUrl=this.getFullURL("")}else{this._saveServiceUrl="https://api.myjson.com/bins"}}babelHelpers.get(babelHelpers.getPrototypeOf(PurrSistMyJson.prototype),"connectedCallback",this).call(this)}},{key:"onPropsChange",value:function onPropsChange(n){if(!this._saveServiceUrl)return;babelHelpers.get(babelHelpers.getPrototypeOf(PurrSistMyJson.prototype),"onPropsChange",this).call(this)}},{key:"getStore",value:function getStore(){var _this8=this;if(this._fip)return;this._fip=!0;fetch(this._saveServiceUrl+"/"+this._storeId).then(function(resp){resp.json().then(function(json){json.__purrSistInit=!0;console.log(json);_this8.value=json;_this8._fip=!1})})}},{key:"saveServiceUrl",get:function get(){return this._saveServiceUrl},set:function set(val){this.attr(save_service_url,val)}}],[{key:"is",get:function get(){return"purr-sist-myjson"}},{key:"observedAttributes",get:function get(){return babelHelpers.get(babelHelpers.getPrototypeOf(PurrSistMyJson),"observedAttributes",this).concat([save_service_url])}}]);return PurrSistMyJson}(PurrSist);define(PurrSistMyJson)})();